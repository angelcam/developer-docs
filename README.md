# Angelcam Developer docs

Sources for http://developers.angelcam.com, API and guides documentation, generated by [Dapperdox](http://dapperdox.io/) from Markdown (guides) and Swagger (API reference) files.

## Writing

Dapperdox is tool for documenting APIs. Every API documentation can contain

* textual guides in [GFM Markdown](https://guides.github.com/features/mastering-markdown/) 
* API reference in [OpenAPI](http://swagger.io/specification/) (formerly known as Swagger) in `dapperdox_src/spec/`

Dapperdox combines both into single portal website. We currently publish only API ("Angelcam API") but it supports even multiple API documentations (in future it can be "billing API", "dispatcher API" etc.)

All content lies in `dapperdox_src/` folder:

* `dapperdox_src/assets/` contains guides and content overlays
* `dapperdox_src/specs/` contains only one file `swagger.yaml`

OpenAPI specification must be exactly named `swagger.yaml`. No other filename or writing in JSON is supported. Dapperdox can read only OpenAPI in JSON thus this image convert `specs/swagger.yaml` to `swagger.json` on each build. In other words, don't create or modify `swagger.json` as it will be overwritten.

Study yourself [Dapperdox authoring content concepts](http://dapperdox.io/docs/author-concepts) how to write a new content.

## Build and run

_For your convenience, steps bellow are scripted in `./build_run.sh`._

Image contains both Dapperdox and sources (assets and specs). To build image with sources:

    $ docker build -t angelcam/developer-docs .

To run developer website from this image you must

* choose host machine port - Dapperdox runs on 3123 and it's best to use the same on host
* choose container meaningful name like 'developer-docs`

In words of commandline e.g.:

    $ docker run --rm --name developer-docs \
            -p 3123:3123 \
            angelcam/developer-docs

Then go to http://localhost:3123 in your web browser and enjoy!

## Rebuild and push image

After every change in Markdown or Swagger file(s), you must rebuild and push image.

For your convenience there is `build_push.sh` script for quick rebuild and pushing under `angelcam/developer-docs:latest` tag. You must be `docker login` to push as Angelcam Docker Hub account.

To build only, run `build.sh`.

## Deployment

Test environment (developers.test.angelcam.com):

    cd ci/deploy && ansible-playbook -i inventory/test deploy.yml

Production (developers.angelcam.com):

    cd ci/deploy && ansible-playbook -i inventory/prod deploy.yml